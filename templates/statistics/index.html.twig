{% extends 'front_office/base.html.twig' %}

{% block title %}Statistiques - FC Club{% endblock %}

{% block body %}
<div class="container-fluid py-4">
    <div class="d-flex align-items-center justify-content-between mb-5">
        <div>
            <h1 class="h2 fw-bold mb-2" style="background: linear-gradient(135deg, var(--primary) 0%, #3b82f6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                <i class="lucide-bar-chart-3 me-2"></i>Tableau de Bord Analytique
            </h1>
            <p class="text-muted mb-0">Visualisez l'engagement et les performances de vos annonces en temps réel.</p>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-outline-secondary btn-sm rounded-pill px-3">
                <i class="lucide-download me-1"></i>Exporter
            </button>
            <button class="btn btn-primary btn-sm rounded-pill px-3">
                <i class="lucide-refresh-cw me-1"></i>Actualiser
            </button>
        </div>
    </div>

    <div class="row g-4 mb-5">
        <div class="col-md-4">
            <div class="stats-card-premium shadow-sm">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div class="stats-icon-wrapper bg-primary-soft">
                        <i class="lucide-message-circle text-primary"></i>
                    </div>
                    <span class="badge rounded-pill bg-success-soft text-success">+12%</span>
                </div>
                <h3 class="h1 fw-800 mb-1" style="color: #1e293b;">{{ data|default([])|reduce((carry, item) => carry + item, 0) }}</h3>
                <p class="text-muted small mb-0 fw-500 uppercase tracking-wider">Total des Commentaires</p>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="stats-card-premium shadow-sm">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div class="stats-icon-wrapper bg-info-soft">
                        <i class="lucide-megaphone text-info"></i>
                    </div>
                </div>
                <h3 class="h1 fw-800 mb-1" style="color: #1e293b;">{{ chart.data.labels|length }}</h3>
                <p class="text-muted small mb-0 fw-500 uppercase tracking-wider">Annonces Publiées</p>
            </div>
        </div>

        <div class="col-md-4">
            <div class="stats-card-premium shadow-sm">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div class="stats-icon-wrapper bg-purple-soft">
                        <i class="lucide-users text-purple"></i>
                    </div>
                </div>
                <h3 class="h1 fw-800 mb-1" style="color: #1e293b;">{{ (data|default([])|reduce((carry, item) => carry + item, 0) / (chart.data.labels|length ?: 1))|number_format(1) }}</h3>
                <p class="text-muted small mb-0 fw-500 uppercase tracking-wider">Moyenne par Annonce</p>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="chart-container-premium shadow-sm">
                <div class="d-flex align-items-center justify-content-between mb-4">
                    <h4 class="h5 fw-bold text-slate-800 mb-0">Répartition de l'Engagement</h4>
                    <div class="dropdown">
                        <button class="btn btn-link text-muted p-0" data-bs-toggle="dropdown"><i class="lucide-more-horizontal"></i></button>
                    </div>
                </div>
                <div style="height: 400px; position: relative;">
                    {{ render_chart(chart) }}
                    <div class="chart-center-label">
                        <span class="label-value">{{ data|default([])|reduce((carry, item) => carry + item, 0) }}</span>
                        <span class="label-text">INTERACTIONS</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="chart-container-premium shadow-sm h-100">
                <h4 class="h5 fw-bold text-slate-800 mb-4">Top Annonces</h4>
                <div class="list-group list-group-flush">
                    {% for label in chart.data.labels %}
                        <div class="list-group-item px-0 border-0 mb-3 d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center gap-3">
                                <div class="rounded-circle" style="width: 10px; height: 10px; background-color: {{ chart.data.datasets[0].backgroundColor[loop.index0] }}"></div>
                                <span class="text-slate-700 fw-500 small text-truncate" style="max-width: 150px;">{{ label }}</span>
                            </div>
                            <span class="fw-bold text-slate-900 small">{{ chart.data.datasets[0].data[loop.index0] }}</span>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    :root {
        --primary-soft: rgba(16, 185, 129, 0.1);
        --info-soft: rgba(59, 130, 246, 0.1);
        --purple-soft: rgba(139, 92, 246, 0.1);
        --success-soft: rgba(34, 197, 94, 0.1);
        --slate-800: #1e293b;
        --slate-900: #0f172a;
        --slate-700: #334155;
    }

    .fw-800 { font-weight: 800; }
    .fw-500 { font-weight: 500; }
    .uppercase { text-transform: uppercase; }
    .tracking-wider { letter-spacing: 0.05em; }

    .stats-card-premium {
        background: #ffffff;
        border-radius: 20px;
        padding: 24px;
        border: 1px solid #f1f5f9;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .stats-card-premium:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
    }

    .stats-icon-wrapper {
        width: 48px;
        height: 48px;
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
    }

    .chart-container-premium {
        background: #ffffff;
        border-radius: 24px;
        padding: 32px;
        border: 1px solid #f1f5f9;
    }

    .bg-primary-soft { background: var(--primary-soft); }
    .bg-info-soft { background: var(--info-soft); }
    .bg-purple-soft { background: var(--purple-soft); }
    .bg-success-soft { background: var(--success-soft); }
    
    .text-purple { color: #8b5cf6; }
    .text-slate-800 { color: var(--slate-800); }
    .text-slate-700 { color: var(--slate-700); }
    .text-slate-900 { color: var(--slate-900); }

    .chart-center-label {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        pointer-events: none;
    }

    .label-value {
        display: block;
        font-size: 36px;
        font-weight: 800;
        color: #1e293b;
        line-height: 1;
    }

    .label-text {
        font-size: 10px;
        font-weight: 700;
        color: #94a3b8;
        letter-spacing: 2px;
        text-transform: uppercase;
    }

    .list-group-item {
        background: transparent;
    }
</style>
{% endblock %}
