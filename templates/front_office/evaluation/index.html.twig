{% extends 'front_office/base.html.twig' %}

{% block title %}Evaluations - Admin{% endblock %}
{% block page_title %}Evaluations{% endblock %}

{% block header_actions %}
  <a href="{{ path('front_evaluation_new') }}" class="btn btn-primary btn-sm">
    <i class="lucide-plus" style="font-size:14px"></i>
    Ajouter
  </a>
{% endblock %}

{% block body %}

<div class="data-table">

  <div class="data-table-header">
    <h3>Liste des évaluations</h3>
    <span class="text-muted" style="font-size:13px">
      {{ evaluations|length }} évaluation(s)
    </span>
  </div>

  {# ===== Recherche ===== #}
  <form method="get" class="mb-4">
    <div class="input-group" style="max-width:400px">
      <input type="text"
             name="search_nom"
             value="{{ search_nom|default('') }}"
             class="form-control"
             placeholder="Recherche par nom du joueur">
      <button type="submit" class="btn btn-outline-secondary">
        Rechercher
      </button>
    </div>
  </form>

  {% if evaluations is not empty %}
    <table class="table">
      <thead>
        <tr>
          <th>Joueur</th>
          <th>Entrainement</th>
          <th>Physique</th>
          <th>Technique</th>
          <th>Tactique</th>
          <th class="text-end">Actions</th>
        </tr>
      </thead>

      <tbody>
        {% for evaluation in evaluations %}
          {% if search_nom is empty or search_nom|lower in evaluation.joueur.nom|lower %}
            <tr>
              <td>{{ evaluation.joueur.nom }} {{ evaluation.joueur.prenom }}</td>
              <td>{{ evaluation.entrainement.type }}</td>
              <td>{{ evaluation.notePhysique }}</td>
              <td>{{ evaluation.noteTechnique }}</td>
              <td>{{ evaluation.noteTactique }}</td>

              <td class="text-end">
                <a href="{{ path('front_evaluation_show', { id: evaluation.id }) }}"
                   class="btn btn-sm btn-outline-secondary">
                  Voir
                </a>

                <a href="{{ path('front_evaluation_edit', { id: evaluation.id }) }}"
                   class="btn btn-sm btn-outline-secondary">
                  Éditer
                </a>

                <button
                  type="button"
                  class="btn btn-sm btn-outline-danger"
                  onclick="openDeleteModal(
                    {{ evaluation.id }},
                    '{{ csrf_token('delete' ~ evaluation.id) }}'
                  )"
                >
                  Supprimer
                </button>
              </td>
            </tr>
          {% endif %}
        {% endfor %}
      </tbody>
    </table>

    <div class="text-center mt-4">
      <a href="{{ path('front_evaluation_new') }}" class="btn btn-primary btn-sm">
        <i class="lucide-plus" style="font-size:14px"></i>
        Ajouter une évaluation
      </a>
    </div>

  {% else %}
    <div class="text-center p-5">
      <p class="text-muted">Aucune évaluation pour le moment.</p>
      <a href="{{ path('front_evaluation_new') }}" class="btn btn-primary mt-3">
        + Créer une évaluation
      </a>
    </div>
  {% endif %}

</div>

{# ===== MODAL SUPPRESSION ===== #}
<div id="deleteModal" class="modal fade" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Confirmation</h5>
        <button type="button" class="btn-close" onclick="closeDeleteModal()"></button>
      </div>

      <div class="modal-body">
        <p>Êtes-vous sûr de vouloir supprimer cette évaluation ?</p>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeDeleteModal()">
          Annuler
        </button>

        <form id="deleteForm" method="post">
          <input type="hidden" name="_token" id="deleteToken">
          <button type="submit" class="btn btn-danger">
            Supprimer
          </button>
        </form>
      </div>

    </div>
  </div>
</div>

<script>
function openDeleteModal(id, token) {
  const modal = document.getElementById('deleteModal');
  const form = document.getElementById('deleteForm');
  const tokenInput = document.getElementById('deleteToken');

  form.action = "{{ path('front_evaluation_delete', {'id': 'ID'}) }}".replace('ID', id);
  tokenInput.value = token;

  modal.style.display = 'block';
  modal.classList.add('show');
}

function closeDeleteModal() {
  const modal = document.getElementById('deleteModal');
  modal.style.display = 'none';
  modal.classList.remove('show');
}
</script>

{% endblock %}
