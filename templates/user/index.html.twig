{% extends 'base.html.twig' %}

{% block title %}Liste des Utilisateurs{% endblock %}

{% block body %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="bi bi-people"></i> Liste des Utilisateurs</h1>
    <a href="{{ path('app_user_new') }}" class="btn btn-primary">
        <i class="bi bi-plus-lg"></i> Nouvel Utilisateur
    </a>
</div>

<div class="card">
  <div class="card-body p-0">
    <table class="table table-hover table-striped mb-0">
      <thead>
        <tr>
          <th>#</th>
          <th>Photo</th>
          <th>Nom Complet</th>
          <th>Email</th>
          <th>Telephone</th>
          <th>Statut</th>
          <th>Role</th>
          <th class="text-center">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
        <tr>
          <td>{{ user.id }}</td>
          <td>
            {% if user.photo %}
              <img src="{{ asset('uploads/photos/' ~ user.photo) }}"
                   class="rounded-circle" width="40" height="40">
            {% else %}
              <span class="badge bg-secondary">N/A</span>
            {% endif %}
          </td>
          <td>{{ user.nomComplet }}</td>
          <td>{{ user.email }}</td>
          <td>{{ user.telephone ?? '---' }}</td>
          <td>
            <span class="badge bg-{{ user.isActif ? 'success' : 'danger' }}">
              {{ user.statut|capitalize }}
            </span>
          </td>
          <td>
            {% for role in user.roles %}
              <span class="badge bg-info">{{ role }}</span>
            {% endfor %}
          </td>
          <td class="text-center">
            <a href="{{ path('app_user_show', {id: user.id}) }}"
               class="btn btn-sm btn-info" title="Voir">
              <i class="bi bi-eye"></i>
            </a>
            <a href="{{ path('app_user_edit', {id: user.id}) }}"
               class="btn btn-sm btn-warning" title="Modifier">
              <i class="bi bi-pencil"></i>
            </a>
            <form method="post"
                  action="{{ path('app_user_delete', {id: user.id}) }}"
                  style="display:inline"
                  onsubmit="return confirm('Supprimer cet utilisateur ?')">
              <input type="hidden" name="_token"
                     value="{{ csrf_token('delete' ~ user.id) }}">
              <button class="btn btn-sm btn-danger" title="Supprimer">
                <i class="bi bi-trash"></i>
              </button>
            </form>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="8" class="text-center text-muted py-4">
            <i class="bi bi-inbox" style="font-size: 2rem;"></i>
            <p>Aucun utilisateur trouve.</p>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}