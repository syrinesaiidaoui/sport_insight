{% extends 'back_office/base.html.twig' %}

{% block title %}Entrainements - Admin{% endblock %}

{% block page_title %}Entrainements{% endblock %}

{% block header_actions %}
  <a href="{{ path('back_entrainement_new') }}" class="btn btn-primary btn-sm">
    <i class="lucide-plus" style="font-size:14px"></i>
    Ajouter
  </a>
{% endblock %}

{% block body %}

<div class="data-table">


  <div class="data-table-header flex items-center justify-between mb-4">
    <div>
      <h3>Liste des entrainements</h3>
      <span class="text-muted" style="font-size:13px">
        {{ entrainements|length }} entrainement(s)
      </span>
    </div>
    <form method="get" class="flex gap-2 items-center">
      <input type="text" name="search_type" value="{{ search_type|default('') }}"
             placeholder="Rechercher par type"
             class="form-input px-2 py-1 rounded border border-gray-300">
      <select name="sort_by" class="form-select px-2 py-1 rounded border border-gray-300">
        <option value="">Trier par</option>
        <option value="dateEntrainement" {% if sort_by == 'dateEntrainement' %}selected{% endif %}>Date</option>
      </select>
      <select name="sort_dir" class="form-select px-2 py-1 rounded border border-gray-300">
        <option value="asc" {% if sort_dir == 'asc' %}selected{% endif %}>Ascendant</option>
        <option value="desc" {% if sort_dir == 'desc' %}selected{% endif %}>Descendant</option>
      </select>
      <button type="submit" class="btn btn-sm btn-secondary">Rechercher / Trier</button>
    </form>
  </div>

  {% if entrainements is not empty %}
    <table class="table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Type</th>
          <th>Lieu</th>
          <th>Horaire</th>
          <th style="text-align:right">Actions</th>
        </tr>
      </thead>

      <tbody>
        {% set searchTypeValue = search_type|default('') %}
        {% set sortBy = sort_by|default('') %}
        {% set sortDir = sort_dir|default('asc') %}
        {% set filtered = entrainements|filter(e => searchTypeValue == '' or searchTypeValue|lower in e.type|lower) %}
        {% if sortBy == 'dateEntrainement' %}
          {% set filtered = filtered|sort((a, b) => sortDir == 'asc' ? (a.dateEntrainement <=> b.dateEntrainement) : (b.dateEntrainement <=> a.dateEntrainement)) %}
        {% endif %}
        {% for entrainement in filtered %}
          <tr>
            <td>
              {{ entrainement.dateEntrainement|date('d/m/Y') }}
            </td>

            <td>
              {{ entrainement.type }}
            </td>

            <td>
              {{ entrainement.lieu }}
            </td>

            <td>
              {{ entrainement.heureDebut|date('H:i') }}
              -
              {{ entrainement.heureFin|date('H:i') }}
            </td>

            <td style="text-align:right">
              <a href="{{ path('back_entrainement_show', { id: entrainement.id }) }}"
                 class="btn btn-sm btn-outline-secondary"
                 style="padding:4px 8px">
                Voir
              </a>

              <a href="{{ path('back_entrainement_edit', { id: entrainement.id }) }}"
                 class="btn btn-sm btn-outline-secondary"
                 style="padding:4px 8px">
                Éditer
              </a>

              <form method="post"
                    action="{{ path('back_entrainement_delete', { id: entrainement.id }) }}"
                    style="display:inline"
                    onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cet entrainement ?');">
                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ entrainement.id) }}">
                <button type="submit"
                        class="btn btn-sm btn-outline-danger"
                        style="padding:4px 8px">
                  Supprimer
                </button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

  {% else %}
    <div style="text-align:center; padding:40px">
      <p class="text-muted">Aucun entrainement pour le moment.</p>
      <a href="{{ path('back_entrainement_new') }}"
         class="btn btn-primary"
         style="margin-top:16px">
        + Créer un entrainement
      </a>
    </div>
  {% endif %}

</div>

{% endblock %}
