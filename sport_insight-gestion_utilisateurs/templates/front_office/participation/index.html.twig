{% extends 'front_office/base.html.twig' %}

{% block title %}Participations - Admin{% endblock %}
{% block page_title %}Participations{% endblock %}

{% block stylesheets %}
{{ parent() }}
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:        #f0f7f2;
    --surface:   #ffffff;
    --card:      #f8fdf9;
    --border:    #d1e8d8;
    --accent:    #16a34a;
    --accent-lt: #22c55e;
    --accent-dk: #14532d;
    --accent2:   #ef4444;
    --gold:      #f59e0b;
    --text:      #1a2e22;
    --muted:     #6b8f77;
    --radius:    12px;
  }

  body { background: var(--bg); color: var(--text); font-family: 'DM Sans', sans-serif; margin: 0; }

  /* â”€â”€â”€ HERO BANNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .hero-banner {
    position: relative; height: 240px; overflow: hidden;
    border-radius: 0 0 24px 24px; margin-bottom: 32px;
  }
  .hero-bg {
    position: absolute; inset: 0;
    background-image: url('https://images.unsplash.com/photo-1529156069898-49953e39b3ac?w=1400&auto=format&fit=crop&q=80');
    background-size: cover; background-position: center 40%;
    filter: brightness(.42) saturate(1.2);
    transform: scale(1.04); transition: transform 8s ease;
  }
  .hero-banner:hover .hero-bg { transform: scale(1); }
  .hero-overlay {
    position: absolute; inset: 0;
    background: linear-gradient(135deg, rgba(20,83,45,.78) 0%, rgba(22,163,74,.28) 60%, rgba(0,0,0,.05) 100%);
  }
  .hero-dots { position: absolute; right: 60px; top: 50%; transform: translateY(-50%); opacity: .12; pointer-events: none; }
  .hero-content {
    position: relative; z-index: 2; height: 100%;
    display: flex; align-items: flex-end; justify-content: space-between; padding: 28px 40px;
  }
  .page-heading {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(52px, 8vw, 96px); letter-spacing: 4px; line-height: .9;
    color: #fff; text-shadow: 0 4px 24px rgba(0,0,0,.4);
  }
  .page-heading small {
    display: block; font-family: 'DM Sans', sans-serif;
    font-size: 12px; font-weight: 500; letter-spacing: 4px;
    text-transform: uppercase; color: #86efac; margin-bottom: 6px;
  }
  .hero-stats { display: flex; gap: 16px; align-items: flex-end; }
  .stat-pill {
    text-align: center; background: rgba(255,255,255,.12); backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,.22); border-radius: 14px; padding: 12px 22px; color: white;
  }
  .stat-pill .num { font-family: 'Bebas Neue', sans-serif; font-size: 36px; letter-spacing: 2px; line-height: 1; color: #4ade80; }
  .stat-pill .lbl { font-size: 10px; text-transform: uppercase; letter-spacing: 2px; color: rgba(255,255,255,.55); margin-top: 3px; }

  /* â”€â”€â”€ BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .btn-add {
    display: inline-flex; align-items: center; gap: 8px;
    padding: 11px 22px; background: var(--accent); color: white;
    font-family: 'DM Sans', sans-serif; font-weight: 600; font-size: 14px;
    border: none; border-radius: var(--radius); text-decoration: none;
    transition: transform .15s, box-shadow .2s, background .15s;
    box-shadow: 0 4px 16px rgba(22,163,74,.3); cursor: pointer;
  }
  .btn-add:hover { background: var(--accent-lt); transform: translateY(-2px); box-shadow: 0 8px 24px rgba(22,163,74,.4); color: white; }
  .btn-add svg { width: 15px; height: 15px; }

  /* â”€â”€â”€ PAGE INNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .page-inner { padding: 0 40px 60px; max-width: 1280px; margin: 0 auto; }

  .action-row {
    display: flex; align-items: center; justify-content: space-between;
    flex-wrap: wrap; gap: 16px; margin-bottom: 20px;
  }

  /* â”€â”€â”€ FILTER BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .filter-wrap {
    display: flex; gap: 12px; align-items: center; flex-wrap: wrap;
    padding: 14px 18px; background: var(--surface);
    border: 1px solid var(--border); border-radius: var(--radius);
    box-shadow: 0 2px 12px rgba(22,163,74,.06); margin-bottom: 28px;
  }
  .filter-wrap label { font-size: 13px; font-weight: 500; color: var(--muted); white-space: nowrap; }
  .filter-wrap select {
    background: var(--card); border: 1px solid var(--border); color: var(--text);
    font-family: 'DM Sans', sans-serif; font-size: 13px; padding: 8px 14px;
    border-radius: 8px; outline: none; transition: border-color .2s, box-shadow .2s;
    min-width: 160px; cursor: pointer;
  }
  .filter-wrap select:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(22,163,74,.12); }

  /* â”€â”€â”€ CARDS GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 18px;
  }

  /* â”€â”€â”€ PARTICIPATION CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .part-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    transition: transform .2s, box-shadow .2s, border-color .2s;
    animation: cardIn .4s ease both;
  }
  .part-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 16px 40px rgba(22,163,74,.11);
    border-color: #86efac;
  }

  @keyframes cardIn {
    from { opacity: 0; transform: translateY(14px); }
    to   { opacity: 1; transform: none; }
  }
  .cards-grid .part-card:nth-child(1)  { animation-delay:.04s }
  .cards-grid .part-card:nth-child(2)  { animation-delay:.08s }
  .cards-grid .part-card:nth-child(3)  { animation-delay:.12s }
  .cards-grid .part-card:nth-child(4)  { animation-delay:.16s }
  .cards-grid .part-card:nth-child(5)  { animation-delay:.20s }
  .cards-grid .part-card:nth-child(6)  { animation-delay:.24s }
  .cards-grid .part-card:nth-child(7)  { animation-delay:.28s }
  .cards-grid .part-card:nth-child(8)  { animation-delay:.32s }

  /* Card top color band based on presence */
  .part-card .card-band {
    height: 5px;
    width: 100%;
  }
  .band-present  { background: linear-gradient(90deg, #16a34a, #4ade80); }
  .band-absent   { background: linear-gradient(90deg, #ef4444, #f87171); }
  .band-undefined{ background: linear-gradient(90deg, #d1e8d8, #a3c4a8); }

  /* Card header: avatar + name + badge */
  .part-card-header {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 18px 20px 14px;
    border-bottom: 1px solid #eaf5ec;
  }

  /* Big avatar circle */
  .part-avatar {
    width: 52px; height: 52px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 22px; letter-spacing: 1px;
    flex-shrink: 0;
    position: relative;
  }
  .part-avatar.av-present  { background: linear-gradient(135deg, #dcfce7, #86efac); color: #14532d; border: 2px solid #4ade80; }
  .part-avatar.av-absent   { background: linear-gradient(135deg, #fee2e2, #fca5a5); color: #7f1d1d; border: 2px solid #f87171; }
  .part-avatar.av-undefined{ background: linear-gradient(135deg, #f0fdf4, #d1e8d8); color: var(--muted); border: 2px solid var(--border); }

  /* Presence dot on avatar */
  .part-avatar::after {
    content: '';
    position: absolute;
    bottom: 1px; right: 1px;
    width: 12px; height: 12px;
    border-radius: 50%;
    border: 2px solid white;
  }
  .av-present::after   { background: #16a34a; }
  .av-absent::after    { background: #ef4444; }
  .av-undefined::after { background: #d1e8d8; }

  .part-name-wrap { flex: 1; min-width: 0; }
  .part-name {
    font-weight: 700; font-size: 15px; color: var(--text);
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }
  .part-training {
    font-size: 12px; color: var(--muted); margin-top: 2px;
    display: flex; align-items: center; gap: 4px;
  }

  /* Presence badge */
  .presence-badge {
    display: inline-flex; align-items: center; gap: 5px;
    padding: 5px 12px; border-radius: 20px;
    font-size: 11px; font-weight: 700; white-space: nowrap; flex-shrink: 0;
  }
  .pres-present  { background: rgba(22,163,74,.1);  color: #15803d; border: 1px solid rgba(22,163,74,.25); }
  .pres-absent   { background: rgba(239,68,68,.08); color: #dc2626; border: 1px solid rgba(239,68,68,.2); }
  .pres-undefined{ background: rgba(107,143,119,.08); color: var(--muted); border: 1px solid var(--border); }

  /* Card body */
  .part-card-body {
    padding: 14px 20px;
    flex: 1;
  }

  .justif-block {
    display: flex;
    align-items: flex-start;
    gap: 8px;
    padding: 10px 14px;
    background: #fffbeb;
    border: 1px solid #fde68a;
    border-radius: 10px;
    font-size: 12px;
    color: #92400e;
    line-height: 1.5;
  }
  .justif-block .justif-icon { font-size: 14px; flex-shrink: 0; margin-top: 1px; }

  /* Card footer */
  .part-card-footer {
    padding: 12px 20px 16px;
    border-top: 1px solid #eaf5ec;
    display: flex; gap: 8px; justify-content: flex-end;
  }

  .btn-action {
    padding: 6px 14px; font-size: 12px; font-weight: 600;
    border-radius: 8px; text-decoration: none; border: 1px solid transparent;
    cursor: pointer; font-family: 'DM Sans', sans-serif;
    transition: all .15s; white-space: nowrap; background: transparent;
  }
  .btn-view   { border-color: var(--border); color: var(--muted); }
  .btn-view:hover   { border-color: var(--accent); color: var(--accent); background: #f0fdf4; }
  .btn-edit   { border-color: var(--border); color: var(--muted); }
  .btn-edit:hover   { border-color: var(--gold); color: #92400e; background: #fffbeb; }
  .btn-delete { border-color: var(--border); color: var(--muted); }
  .btn-delete:hover { border-color: var(--accent2); color: var(--accent2); background: #fef2f2; }

  /* â”€â”€â”€ EMPTY STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .empty-state {
    text-align: center; padding: 80px 20px;
    background: var(--surface); border: 1px solid var(--border); border-radius: 16px;
  }
  .empty-icon {
    width: 72px; height: 72px; margin: 0 auto 20px; border-radius: 20px;
    background: linear-gradient(135deg, #f0fdf4, #dcfce7);
    border: 1px solid #bbf7d0;
    display: flex; align-items: center; justify-content: center; font-size: 32px;
  }
  .empty-state p { color: var(--muted); font-size: 15px; }

  /* â”€â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .modal-overlay {
    display: none; position: fixed; inset: 0;
    background: rgba(20,83,45,.2); backdrop-filter: blur(6px);
    z-index: 1000; align-items: center; justify-content: center;
  }
  .modal-overlay.show { display: flex; }
  .modal-box {
    background: var(--surface); border: 1px solid var(--border);
    border-top: 3px solid var(--accent2); border-radius: var(--radius);
    width: 100%; max-width: 420px; padding: 32px;
    box-shadow: 0 24px 64px rgba(0,0,0,.12); animation: modalIn .2s ease;
  }
  @keyframes modalIn {
    from { opacity: 0; transform: scale(.95) translateY(12px); }
    to   { opacity: 1; transform: none; }
  }
  .modal-box h5 { font-family: 'Bebas Neue', sans-serif; font-size: 28px; letter-spacing: 2px; margin-bottom: 10px; color: var(--accent2); }
  .modal-box p  { color: var(--muted); font-size: 14px; line-height: 1.7; margin-bottom: 28px; }
  .modal-footer-btns { display: flex; gap: 10px; justify-content: flex-end; }
  .btn-cancel { padding: 10px 20px; background: transparent; border: 1px solid var(--border); color: var(--muted); border-radius: 8px; font-family: 'DM Sans', sans-serif; font-size: 14px; cursor: pointer; transition: border-color .15s, color .15s; }
  .btn-cancel:hover { border-color: var(--text); color: var(--text); }
  .btn-confirm-delete { padding: 10px 24px; background: var(--accent2); border: none; color: white; border-radius: 8px; font-family: 'DM Sans', sans-serif; font-weight: 700; font-size: 14px; cursor: pointer; box-shadow: 0 4px 16px rgba(239,68,68,.25); transition: box-shadow .15s, transform .15s; }
  .btn-confirm-delete:hover { transform: translateY(-1px); box-shadow: 0 8px 24px rgba(239,68,68,.4); }

  @media (max-width: 700px) {
    .hero-content { flex-direction: column; align-items: flex-start; padding: 20px; }
    .hero-stats { display: none; }
    .page-inner { padding: 0 16px 40px; }
    .cards-grid { grid-template-columns: 1fr; }
    .filter-wrap { flex-direction: column; align-items: stretch; }
  }
</style>
{% endblock %}

{% block header_actions %}
  <a href="{{ path('front_participation_new') }}" class="btn-add">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
    Ajouter
  </a>
{% endblock %}

{% block body %}

{# â”€â”€ HERO BANNER â”€â”€ #}
<div class="hero-banner">
  <div class="hero-bg"></div>
  <div class="hero-overlay"></div>
  <svg class="hero-dots" width="200" height="200" viewBox="0 0 200 200" fill="none">
    <circle cx="10" cy="10" r="3" fill="white"/><circle cx="40" cy="10" r="3" fill="white"/><circle cx="70" cy="10" r="3" fill="white"/><circle cx="100" cy="10" r="3" fill="white"/><circle cx="130" cy="10" r="3" fill="white"/><circle cx="160" cy="10" r="3" fill="white"/>
    <circle cx="10" cy="40" r="3" fill="white"/><circle cx="40" cy="40" r="3" fill="white"/><circle cx="70" cy="40" r="3" fill="white"/><circle cx="100" cy="40" r="3" fill="white"/><circle cx="130" cy="40" r="3" fill="white"/><circle cx="160" cy="40" r="3" fill="white"/>
    <circle cx="10" cy="70" r="3" fill="white"/><circle cx="40" cy="70" r="3" fill="white"/><circle cx="70" cy="70" r="3" fill="white"/><circle cx="100" cy="70" r="3" fill="white"/><circle cx="130" cy="70" r="3" fill="white"/><circle cx="160" cy="70" r="3" fill="white"/>
    <circle cx="10" cy="100" r="3" fill="white"/><circle cx="40" cy="100" r="3" fill="white"/><circle cx="70" cy="100" r="3" fill="white"/><circle cx="100" cy="100" r="3" fill="white"/><circle cx="130" cy="100" r="3" fill="white"/><circle cx="160" cy="100" r="3" fill="white"/>
    <circle cx="10" cy="130" r="3" fill="white"/><circle cx="40" cy="130" r="3" fill="white"/><circle cx="70" cy="130" r="3" fill="white"/><circle cx="100" cy="130" r="3" fill="white"/><circle cx="130" cy="130" r="3" fill="white"/><circle cx="160" cy="130" r="3" fill="white"/>
  </svg>
  <div class="hero-content">
    <div class="page-heading">
      <small>/ Suivi des joueurs</small>
      Participations
    </div>
    <div class="hero-stats">
      <div class="stat-pill">
        <div class="num">{{ participations|length }}</div>
        <div class="lbl">Total</div>
      </div>
      <div class="stat-pill">
        <div class="num">ğŸ‘¥</div>
        <div class="lbl">Joueurs</div>
      </div>
    </div>
  </div>
</div>

<div class="page-inner">

  <div class="action-row">
    <div style="font-size:14px; color:var(--muted)">
      <strong style="color:var(--text)">{{ participations|length }}</strong> participation(s) au total
    </div>
    <a href="{{ path('front_participation_new') }}" class="btn-add">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      Ajouter une participation
    </a>
  </div>

  <form method="get" class="filter-wrap">
    <label for="presence-select">Filtrer par prÃ©sence :</label>
    <select name="presence" id="presence-select" onchange="this.form.submit()">
      <option value="" {% if not presence %}selected{% endif %}>Tous</option>
      <option value="present" {% if presence == 'present' %}selected{% endif %}>âœ“ PrÃ©sent</option>
      <option value="absent"  {% if presence == 'absent'  %}selected{% endif %}>âœ• Absent</option>
    </select>
  </form>

  {# â”€â”€ CARDS GRID â”€â”€ #}
  {% if participations %}
    <div class="cards-grid">
      {% for participation in participations %}

        {% set presence = participation.presence %}
        {% set bandClass = presence == 'present' ? 'band-present' : (presence == 'absent' ? 'band-absent' : 'band-undefined') %}
        {% set avClass   = presence == 'present' ? 'av-present'   : (presence == 'absent' ? 'av-absent'   : 'av-undefined') %}
        {% set presClass = presence == 'present' ? 'pres-present'  : (presence == 'absent' ? 'pres-absent'  : 'pres-undefined') %}
        {% set presLabel = presence == 'present' ? 'âœ“ PrÃ©sent'     : (presence == 'absent' ? 'âœ• Absent'     : 'â€” Non dÃ©fini') %}

        <div class="part-card">

          {# Color band on top #}
          <div class="card-band {{ bandClass }}"></div>

          {# Header: avatar + name + presence badge #}
          <div class="part-card-header">
            <div class="part-avatar {{ avClass }}">
              {{ participation.joueur.nom|slice(0,1)|upper }}{{ participation.joueur.prenom|slice(0,1)|upper }}
            </div>
            <div class="part-name-wrap">
              <div class="part-name">{{ participation.joueur.nom }} {{ participation.joueur.prenom }}</div>
              <div class="part-training">ğŸ‹ï¸ {{ participation.entrainement.type }}</div>
            </div>
            <span class="presence-badge {{ presClass }}">{{ presLabel }}</span>
          </div>

          {# Body: justification if absent #}
          <div class="part-card-body">
            {% if participation.justificationAbsence is not empty and participation.justificationAbsence != null %}
              <div class="justif-block">
                <span class="justif-icon">ğŸ“</span>
                <span>{{ participation.justificationAbsence }}</span>
              </div>
            {% else %}
              <div style="font-size:12px; color:var(--muted); font-style:italic; padding: 4px 0;">
                Aucun justificatif renseignÃ©
              </div>
            {% endif %}
          </div>

          {# Footer: actions #}
          <div class="part-card-footer">
            <a href="{{ path('front_participation_show', {id: participation.id}) }}" class="btn-action btn-view">Voir</a>
            <a href="{{ path('front_participation_edit', {id: participation.id}) }}" class="btn-action btn-edit">Ã‰diter</a>
            <button type="button" class="btn-action btn-delete"
              onclick="openDeleteModal({{ participation.id }}, '{{ csrf_token('delete' ~ participation.id) }}')">
              Supprimer
            </button>
          </div>

        </div>
      {% endfor %}
    </div>

  {% else %}
    <div class="empty-state">
      <div class="empty-icon">ğŸ‘¥</div>
      <p>Aucune participation pour le moment.</p>
    </div>
  {% endif %}

</div>

{# â”€â”€ MODAL SUPPRESSION â”€â”€ #}
<div id="deleteModal" class="modal-overlay">
  <div class="modal-box">
    <h5>âš  Confirmation</h5>
    <p>ÃŠtes-vous sÃ»r de vouloir supprimer cette participation ?<br>Cette action est irrÃ©versible.</p>
    <div class="modal-footer-btns">
      <button class="btn-cancel" onclick="closeDeleteModal()">Annuler</button>
      <form id="deleteForm" method="post" style="margin:0">
        <input type="hidden" name="_token" id="deleteToken">
        <button type="submit" class="btn-confirm-delete">Supprimer</button>
      </form>
    </div>
  </div>
</div>

<script>
function openDeleteModal(id, token) {
  document.getElementById('deleteToken').value = token;
  document.getElementById('deleteForm').action = "{{ path('front_participation_delete', {'id': 'ID'}) }}".replace('ID', id);
  document.getElementById('deleteModal').classList.add('show');
}
function closeDeleteModal() {
  document.getElementById('deleteModal').classList.remove('show');
}
document.getElementById('deleteModal').addEventListener('click', function(e) {
  if (e.target === this) closeDeleteModal();
});
</script>

{% endblock %}
